{"version":3,"file":"immutabilityHelpers.js","names":["_typeguards","require","_utils","shallowClone","value","isJSONArray","copy","slice","Object","getOwnPropertySymbols","forEach","symbol","isJSONObject","applyProp","object","key","updatedObject","getIn","path","i","length","Number","parseInt","undefined","setIn","createPath","arguments","updatedValue","newObject","IS_INTEGER_REGEX","test","Error","updateIn","transform","isObjectOrArray","deleteIn","splice","insertAt","document","parentPath","index","items","Array","isArray","TypeError","JSON","stringify","updatedItems","callback","updated1","updated2","before","after","concat","String","hasOwnProperty","call","existsIn"],"sources":["../../src/immutabilityHelpers.ts"],"sourcesContent":["/**\n * Immutability helpers\n *\n * inspiration:\n *\n * https://www.npmjs.com/package/seamless-immutable\n * https://www.npmjs.com/package/ih\n * https://www.npmjs.com/package/mutatis\n * https://github.com/mariocasciaro/object-path-immutable\n */\nimport { isJSONArray, isJSONObject } from './typeguards.js'\nimport type { JSONPath } from './types'\nimport { isObjectOrArray } from './utils.js'\n\n/**\n * Shallow clone of an Object, Array, or value\n * Symbols are cloned too.\n */\nexport function shallowClone<T>(value: T): T {\n  if (isJSONArray(value)) {\n    // copy array items\n    const copy: T = value.slice() as T\n\n    // copy all symbols\n    Object.getOwnPropertySymbols(value).forEach((symbol) => {\n      // @ts-ignore\n      copy[symbol] = value[symbol]\n    })\n\n    return copy\n  }\n\n  if (isJSONObject(value)) {\n    // copy object properties\n    const copy: T = { ...value }\n\n    // copy all symbols\n    Object.getOwnPropertySymbols(value).forEach((symbol) => {\n      // @ts-ignore\n      copy[symbol] = value[symbol]\n    })\n\n    return copy\n  }\n\n  return value\n}\n\n/**\n * Update a value in an object in an immutable way.\n * If the value is unchanged, the original object will be returned\n */\nexport function applyProp<T, U = unknown>(object: T, key: string | number, value: U): T {\n  // @ts-ignore\n  if (object[key] === value) {\n    // return original object unchanged when the new value is identical to the old one\n    return object\n  }\n\n  const updatedObject = shallowClone(object)\n  // @ts-ignore\n  updatedObject[key] = value\n  return updatedObject\n}\n\n/**\n * helper function to get a nested property in an object or array\n *\n * @return Returns the field when found, or undefined when the path doesn't exist\n */\nexport function getIn<T, U = unknown>(object: U, path: JSONPath): T | undefined {\n  let value: T | undefined = object as unknown as T\n  let i = 0\n\n  while (i < path.length) {\n    if (isJSONObject(value)) {\n      value = value[path[i]] as T\n    } else if (isJSONArray(value)) {\n      value = value[Number.parseInt(path[i])] as T\n    } else {\n      value = undefined\n    }\n\n    i++\n  }\n\n  return value\n}\n\n/**\n * helper function to replace a nested property in an object with a new value\n * without mutating the object itself.\n *\n * @param object\n * @param path\n * @param value\n * @param [createPath=false]\n *                    If true, `path` will be created when (partly) missing in\n *                    the object. For correctly creating nested Arrays or\n *                    Objects, the function relies on `path` containing number\n *                    in case of array indexes.\n *                    If false (default), an error will be thrown when the\n *                    path doesn't exist.\n * @return Returns a new, updated object or array\n */\nexport function setIn<T, U = unknown, V = unknown>(\n  object: U,\n  path: JSONPath,\n  value: V,\n  createPath = false\n): T {\n  if (path.length === 0) {\n    return value as unknown as T\n  }\n\n  const key = path[0]\n  // @ts-ignore\n  const updatedValue = setIn(object ? object[key] : undefined, path.slice(1), value, createPath)\n\n  if (isJSONObject(object) || isJSONArray(object)) {\n    return applyProp(object, key, updatedValue) as T\n  }\n\n  if (createPath) {\n    const newObject = IS_INTEGER_REGEX.test(key) ? [] : {}\n    // @ts-ignore\n    newObject[key] = updatedValue\n    return newObject as T\n  }\n\n  throw new Error('Path does not exist')\n}\n\nconst IS_INTEGER_REGEX = /^\\d+$/\n\n/**\n * helper function to replace a nested property in an object with a new value\n * without mutating the object itself.\n *\n * @return  Returns a new, updated object or array\n */\nexport function updateIn<T, U = unknown, V = unknown>(\n  object: T,\n  path: JSONPath,\n  transform: (value: U) => V\n): T {\n  if (path.length === 0) {\n    return transform(object as unknown as U) as unknown as T\n  }\n\n  if (!isObjectOrArray(object)) {\n    throw new Error(\"Path doesn't exist\")\n  }\n\n  const key = path[0]\n  // @ts-ignore\n  const updatedValue = updateIn(object[key], path.slice(1), transform)\n  // @ts-ignore\n  return applyProp(object, key, updatedValue)\n}\n\n/**\n * helper function to delete a nested property in an object\n * without mutating the object itself.\n *\n * @return Returns a new, updated object or array\n */\nexport function deleteIn<T, U = unknown>(object: U, path: JSONPath): T {\n  if (path.length === 0) {\n    return object as unknown as T\n  }\n\n  if (!isObjectOrArray(object)) {\n    throw new Error('Path does not exist')\n  }\n\n  if (path.length === 1) {\n    const key = path[0]\n    if (!(key in (object as object))) {\n      // key doesn't exist. return object unchanged\n      return object as unknown as T\n    }\n    const updatedObject = shallowClone(object)\n\n    if (isJSONArray(updatedObject)) {\n      updatedObject.splice(Number.parseInt(key), 1)\n    }\n\n    if (isJSONObject(updatedObject)) {\n      delete updatedObject[key]\n    }\n\n    return updatedObject as unknown as T\n  }\n\n  const key = path[0]\n  // @ts-ignore\n  const updatedValue = deleteIn(object[key], path.slice(1))\n  // @ts-ignore\n  return applyProp(object, key, updatedValue)\n}\n\n/**\n * Insert a new item in an array at a specific index.\n * Example usage:\n *\n *     insertAt({arr: [1,2,3]}, ['arr', '2'], 'inserted')  // [1,2,'inserted',3]\n */\nexport function insertAt<T, U = unknown>(document: T, path: JSONPath, value: U): T {\n  const parentPath = path.slice(0, path.length - 1)\n  const index = path[path.length - 1]\n\n  return updateIn(document, parentPath, (items) => {\n    if (!Array.isArray(items)) {\n      throw new TypeError(`Array expected at path ${JSON.stringify(parentPath)}`)\n    }\n\n    const updatedItems = shallowClone(items)\n    updatedItems.splice(Number.parseInt(index), 0, value)\n\n    return updatedItems\n  })\n}\n\n/**\n * Transform a JSON object, traverse over the whole object,\n * and allow replacing Objects/Arrays/values.\n */\nexport function transform<T, U = unknown, V = unknown, W = unknown>(\n  document: U,\n  callback: (document: V, path: JSONPath) => W,\n  path: JSONPath = []\n): T {\n  const updated1 = callback(document as unknown as V, path)\n\n  if (isJSONArray(updated1)) {\n    let updated2: unknown[] | undefined\n\n    for (let i = 0; i < updated1.length; i++) {\n      const before = updated1[i]\n      // we stringify the index here, so the path only contains strings and can be safely\n      // stringified/parsed to JSONPointer without loosing information.\n      // We do not want to rely on path keys being numeric/string.\n      const after = transform(before, callback, path.concat(String(i)))\n      if (after !== before) {\n        if (!updated2) {\n          updated2 = shallowClone(updated1)\n        }\n        updated2[i] = after\n      }\n    }\n\n    return (updated2 || updated1) as T\n  }\n\n  if (isJSONObject(updated1)) {\n    let updated2: Record<string, unknown> | undefined\n\n    for (const key in updated1) {\n      // biome-ignore lint/suspicious/noPrototypeBuiltins: keep using the old way for now for backward compatibility\n      if (Object.hasOwnProperty.call(updated1, key)) {\n        const before = updated1[key]\n        const after = transform(before, callback, path.concat(key))\n        if (after !== before) {\n          if (!updated2) {\n            updated2 = shallowClone(updated1)\n          }\n          updated2[key] = after\n        }\n      }\n    }\n\n    return (updated2 || updated1) as T\n  }\n\n  return updated1 as unknown as T\n}\n\n/**\n * Test whether a path exists in a JSON object\n * @return Returns true if the path exists, else returns false\n */\nexport function existsIn<T>(document: T, path: JSONPath): boolean {\n  if (document === undefined) {\n    return false\n  }\n\n  if (path.length === 0) {\n    return true\n  }\n\n  if (document === null) {\n    return false\n  }\n\n  // @ts-ignore\n  return existsIn(document[path[0]], path.slice(1))\n}\n"],"mappings":"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","ignoreList":[]}